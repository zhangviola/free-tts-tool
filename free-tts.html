<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å…è´¹ TTS è¯­éŸ³åˆæˆ</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
            background: #f5f5f7;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { margin: 0 0 20px 0; font-size: 24px; }
        .input-group { margin-bottom: 16px; }
        label { display: block; font-weight: 500; margin-bottom: 6px; color: #333; }
        textarea, input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        textarea { height: 100px; font-size: 16px; resize: vertical; }
        .provider-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        .provider-tab {
            padding: 10px 20px;
            background: #f1f3f4;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        .provider-tab.active { background: #6741d9; color: white; border-color: #6741d9; }
        .provider-tab:hover:not(.active) { background: #e8eaed; }
        .provider-panel { display: none; }
        .provider-panel.active { display: block; }
        .api-note {
            font-size: 12px;
            color: #666;
            margin-top: 6px;
        }
        .api-note a { color: #6741d9; }
        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #6741d9;
            color: white;
        }
        .btn-primary:hover { background: #5432b8; }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; }
        .button-row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        .status {
            margin-top: 12px;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }
        .status.error { background: #fee; color: #c33; display: block; }
        .status.success { background: #efe; color: #3c3; display: block; }
        .status.loading { background: #eef; color: #33c; display: block; }
        .audio-player { margin-top: 16px; display: none; }
        .audio-player audio { width: 100%; }
        .info-box {
            background: #e8f4fd;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 13px;
        }
        .info-box strong { color: #0066cc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ™ï¸ å…è´¹ TTS è¯­éŸ³åˆæˆ</h1>

        <div class="info-box">
            <strong>å…è´¹é¢åº¦è¯´æ˜ï¼š</strong><br>
            â€¢ <strong>OpenAI</strong>: å……å€¼åä½¿ç”¨ï¼Œ$5 å¯ç”¨å¾ˆä¹…<br>
            â€¢ <strong>Google Cloud</strong>: æ¯æœˆå…è´¹ 100 ä¸‡å­—ç¬¦<br>
            â€¢ <strong>Microsoft Azure</strong>: æ¯æœˆå…è´¹ 5 å°æ—¶<br>
            â€¢ <strong>Deepgram</strong>: æ¯æœˆå…è´¹ 200 ç¾å…ƒé¢åº¦
        </div>

        <div class="provider-tabs">
            <div class="provider-tab active" onclick="switchProvider('openai')">OpenAI</div>
            <div class="provider-tab" onclick="switchProvider('google')">Google Cloud</div>
            <div class="provider-tab" onclick="switchProvider('azure')">Microsoft Azure</div>
            <div class="provider-tab" onclick="switchProvider('deepgram')">Deepgram</div>
        </div>

        <div class="input-group">
            <label>è¦æœ—è¯»çš„æ–‡æœ¬</label>
            <textarea id="text" placeholder="è¾“å…¥æ–‡æœ¬...">Hello, how are you today? I hope you're having a wonderful day!</textarea>
        </div>

        <!-- OpenAI Panel -->
        <div id="panel-openai" class="provider-panel active">
            <div class="input-group">
                <label>API Key</label>
                <input type="password" id="openai-key" placeholder="sk-...">
                <div class="api-note">åœ¨ <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a> è·å–ï¼Œéœ€å……å€¼ï¼ˆæœ€ä½$5ï¼‰</div>
            </div>
            <div class="input-group">
                <label>å£°éŸ³</label>
                <select id="openai-voice">
                    <option value="alloy">Alloy (ä¸­æ€§)</option>
                    <option value="echo">Echo (ç”·å£°)</option>
                    <option value="fable">Fable (è‹±å¼)</option>
                    <option value="onyx">Onyx (æ·±æ²‰ç”·å£°)</option>
                    <option value="nova">Nova (å¥³å£°)</option>
                    <option value="shimmer">Shimmer (å¥³å£°)</option>
                </select>
            </div>
            <div class="input-group">
                <label>æ¨¡å‹</label>
                <select id="openai-model">
                    <option value="tts-1">tts-1 (å¿«é€Ÿ)</option>
                    <option value="tts-1-hd">tts-1-hd (é«˜æ¸…)</option>
                </select>
            </div>
        </div>

        <!-- Google Cloud Panel -->
        <div id="panel-google" class="provider-panel">
            <div class="input-group">
                <label>API Key</label>
                <input type="password" id="google-key" placeholder="AIza...">
                <div class="api-note">åœ¨ <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a> åˆ›å»ºï¼Œå¯ç”¨ Text-to-Speech API</div>
            </div>
            <div class="input-group">
                <label>å£°éŸ³</label>
                <select id="google-voice">
                    <option value="en-US-Neural2-A">A (å¥³, ç¾å¼)</option>
                    <option value="en-US-Neural2-B">B (ç”·, ç¾å¼)</option>
                    <option value="en-US-Neural2-C">C (å¥³, ç¾å¼)</option>
                    <option value="en-US-Neural2-D">D (ç”·, ç¾å¼)</option>
                    <option value="en-US-Neural2-E">E (å¥³, ç¾å¼)</option>
                    <option value="en-US-Neural2-F">F (ç”·, ç¾å¼)</option>
                    <option value="en-GB-Neural2-A">A (å¥³, è‹±å¼)</option>
                    <option value="en-GB-Neural2-B">B (ç”·, è‹±å¼)</option>
                    <option value="en-GB-Neural2-C">C (å¥³, è‹±å¼)</option>
                    <option value="en-GB-Neural2-D">D (ç”·, è‹±å¼)</option>
                </select>
            </div>
        </div>

        <!-- Azure Panel -->
        <div id="panel-azure" class="provider-panel">
            <div class="input-group">
                <label>API Key</label>
                <input type="password" id="azure-key" placeholder="">
                <div class="api-note">åœ¨ <a href="https://portal.azure.com/" target="_blank">Azure Portal</a> åˆ›å»ºè¯­éŸ³æœåŠ¡</div>
            </div>
            <div class="input-group">
                <label>åŒºåŸŸ</label>
                <select id="azure-region">
                    <option value="eastus">East US</option>
                    <option value="westus">West US</option>
                    <option value="westus2">West US 2</option>
                    <option value="eastasia">East Asia</option>
                    <option value="southeastasia">Southeast Asia</option>
                    <option value="westeurope">West Europe</option>
                    <option value="northeurope">North Europe</option>
                </select>
            </div>
            <div class="input-group">
                <label>å£°éŸ³</label>
                <select id="azure-voice">
                    <option value="en-US-JennyNeural">Jenny (å¥³, ç¾å¼)</option>
                    <option value="en-US-GuyNeural">Guy (ç”·, ç¾å¼)</option>
                    <option value="en-US-AriaNeural">Aria (å¥³, ç¾å¼)</option>
                    <option value="en-US-DavisNeural">Davis (ç”·, ç¾å¼)</option>
                    <option value="en-US-BrandonNeural">Brandon (ç”·, ç¾å¼)</option>
                    <option value="en-US-ElizabethNeural">Elizabeth (å¥³, ç¾å¼)</option>
                    <option value="en-GB-SoniaNeural">Sonia (å¥³, è‹±å¼)</option>
                    <option value="en-GB-RyanNeural">Ryan (ç”·, è‹±å¼)</option>
                    <option value="en-GB-LibbyNeural">Libby (å¥³, è‹±å¼)</option>
                </select>
            </div>
        </div>

        <!-- Deepgram Panel -->
        <div id="panel-deepgram" class="provider-panel">
            <div class="input-group">
                <label>API Key</label>
                <input type="password" id="deepgram-key" placeholder="">
                <div class="api-note">åœ¨ <a href="https://console.deepgram.com/settings/api-keys" target="_blank">Deepgram Console</a> è·å–ï¼Œæ¯æœˆ$200å…è´¹é¢åº¦</div>
            </div>
            <div class="input-group">
                <label>å£°éŸ³</label>
                <select id="deepgram-voice">
                    <option value="aura-asteria-en">Asteria (å¥³)</option>
                    <option value="aura-luna-en">Luna (å¥³)</option>
                    <option value="aura-stella-en">Stella (å¥³)</option>
                    <option value="aura-athena-en">Athena (å¥³)</option>
                    <option value="aura-arcas-en">Arcas (ç”·)</option>
                    <option value="aura-perseus-en">Perseus (ç”·)</option>
                    <option value="aura-zeus-en">Zeus (ç”·)</option>
                    <option value="aura-orion-en">Orion (ç”·)</option>
                </select>
            </div>
        </div>

        <div class="button-row">
            <button class="btn-primary" id="speakBtn" onclick="speak()">ğŸ”Š ç”Ÿæˆè¯­éŸ³</button>
        </div>

        <div id="status" class="status"></div>

        <div class="audio-player" id="audioPlayer">
            <audio id="audio" controls></audio>
        </div>
    </div>

    <script>
        let currentProvider = 'openai';
        let currentAudio = null;

        // Load saved API keys
        function loadKeys() {
            const keys = ['openai', 'google', 'azure', 'deepgram'];
            keys.forEach(provider => {
                const saved = localStorage.getItem(`tts_${provider}_key`);
                if (saved) {
                    document.getElementById(`${provider}-key`).value = saved;
                }
            });
        }
        loadKeys();

        // Save API keys when changed
        ['openai', 'google', 'azure', 'deepgram'].forEach(provider => {
            const input = document.getElementById(`${provider}-key`);
            if (input) {
                input.addEventListener('input', function() {
                    localStorage.setItem(`tts_${provider}_key`, this.value);
                });
            }
        });

        function switchProvider(provider) {
            currentProvider = provider;

            // Update tabs
            document.querySelectorAll('.provider-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update panels
            document.querySelectorAll('.provider-panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(`panel-${provider}`).classList.add('active');

            // Clear status
            showStatus('', '');
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        async function speak() {
            const text = document.getElementById('text').value.trim();
            if (!text) {
                showStatus('è¯·è¾“å…¥è¦æœ—è¯»çš„æ–‡æœ¬', 'error');
                return;
            }

            // Stop current audio if playing
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            showStatus('æ­£åœ¨ç”Ÿæˆè¯­éŸ³...', 'loading');
            document.getElementById('speakBtn').disabled = true;

            try {
                let audioUrl;

                switch (currentProvider) {
                    case 'openai':
                        audioUrl = await openaiTTS(text);
                        break;
                    case 'google':
                        audioUrl = await googleTTS(text);
                        break;
                    case 'azure':
                        audioUrl = await azureTTS(text);
                        break;
                    case 'deepgram':
                        audioUrl = await deepgramTTS(text);
                        break;
                }

                const audio = document.getElementById('audio');
                audio.src = audioUrl;
                document.getElementById('audioPlayer').style.display = 'block';

                currentAudio = audio;
                audio.play();

                showStatus('âœ… ç”ŸæˆæˆåŠŸï¼', 'success');

            } catch (error) {
                showStatus(`âŒ é”™è¯¯: ${error.message}`, 'error');
                console.error('Error:', error);
            } finally {
                document.getElementById('speakBtn').disabled = false;
            }
        }

        async function openaiTTS(text) {
            const apiKey = document.getElementById('openai-key').value.trim();
            if (!apiKey) throw new Error('è¯·è¾“å…¥ OpenAI API Key');

            const voice = document.getElementById('openai-voice').value;
            const model = document.getElementById('openai-model').value;

            const response = await fetch('https://api.openai.com/v1/audio/speech', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: model,
                    input: text,
                    voice: voice
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'è¯·æ±‚å¤±è´¥');
            }

            const blob = await response.blob();
            return URL.createObjectURL(blob);
        }

        async function googleTTS(text) {
            const apiKey = document.getElementById('google-key').value.trim();
            if (!apiKey) throw new Error('è¯·è¾“å…¥ Google Cloud API Key');

            const voice = document.getElementById('google-voice').value;

            const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    input: { text: text },
                    voice: {
                        languageCode: voice.split('-')[0] + '-' + voice.split('-')[1],
                        name: voice
                    },
                    audioConfig: { audioEncoding: 'MP3' }
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'è¯·æ±‚å¤±è´¥');
            }

            const data = await response.json();
            const audioContent = data.audioContent;
            const blob = base64ToBlob(audioContent, 'audio/mp3');
            return URL.createObjectURL(blob);
        }

        async function azureTTS(text) {
            const apiKey = document.getElementById('azure-key').value.trim();
            const region = document.getElementById('azure-region').value;
            if (!apiKey) throw new Error('è¯·è¾“å…¥ Azure API Key');

            const voice = document.getElementById('azure-voice').value;

            const ssml = `<speak version='1.0' xml:lang='en-US'><voice name='${voice}'><prosody rate='0%'>${text}</prosody></voice></speak>`;

            const response = await fetch(`https://${region}.tts.speech.microsoft.com/cognitiveservices/v1`, {
                method: 'POST',
                headers: {
                    'Ocp-Apim-Subscription-Key': apiKey,
                    'Content-Type': 'application/ssml+xml',
                    'X-Microsoft-OutputFormat': 'audio-16khz-128kbitrate-mono-mp3'
                },
                body: ssml
            });

            if (!response.ok) {
                throw new Error('è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Key å’ŒåŒºåŸŸè®¾ç½®');
            }

            const blob = await response.blob();
            return URL.createObjectURL(blob);
        }

        async function deepgramTTS(text) {
            const apiKey = document.getElementById('deepgram-key').value.trim();
            if (!apiKey) throw new Error('è¯·è¾“å…¥ Deepgram API Key');

            const voice = document.getElementById('deepgram-voice').value;

            const response = await fetch(`https://api.deepgram.com/v1/speak?model=${voice}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Token ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: text })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'è¯·æ±‚å¤±è´¥');
            }

            const blob = await response.blob();
            return URL.createObjectURL(blob);
        }

        function base64ToBlob(base64, mimeType) {
            const byteCharacters = atob(base64);
            const byteArrays = [];
            const sliceSize = 512;

            for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                const slice = byteCharacters.slice(offset, offset + sliceSize);
                const byteNumbers = new Array(slice.length);
                for (let i = 0; i < slice.length; i++) {
                    byteNumbers[i] = slice.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                byteArrays.push(byteArray);
            }

            return new Blob(byteArrays, { type: mimeType });
        }
    </script>
</body>
</html>
